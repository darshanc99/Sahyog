{% extends 'home/base.html' %}
{% load static %}
<head>
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
    <link rel="stylesheet" href="{% static 'report/css/starter-template.css' %}">
</head>
{% block content %}
<script src="https://code.jquery.com/jquery-3.3.1.js" integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.3/Chart.bundle.js" integrity="sha256-o8aByMEvaNTcBsw94EfRLbBrJBI+c3mjna/j4LrfyJ8=" crossorigin="anonymous"></script>    
<div class="container">
	<br><h3>My Report</h3><hr>
	<div id="map"></div>
		<div id="legend"><h3>Legend</h3></div>
		<script>
		var map;
		function initMap() {
		map = new google.maps.Map(document.getElementById('map'), {
		zoom: 12,
		center: new google.maps.LatLng(19.07, 72.87),
		mapTypeId: 'roadmap'
		});
	
		var iconBase = 'https://maps.google.com/mapfiles/kml/pal2/';
		var icons = {
		info: {
		name: 'Hunger Spots',
		icon: iconBase + 'icon55.png'
		}
		};
		
		var features = [
		{
		title:'Dahisar',
		position: new google.maps.LatLng(19.256476, 72.872626),
		type: 'info',
		loc_type: 'Encroachment behind buildings',
		hungry: 17
		}, {
		title:'Antop Hill',
		position: new google.maps.LatLng(19.026328, 72.863680),
		type: 'info',
		loc_type: 'Slum',
		hungry: 21
		}, {
		title:'Sewri',
		position: new google.maps.LatLng(18.990100, 72.852736),
		type: 'info',
		loc_type: 'Railway Subway',
		hungry: 30
		}, {
		title:'Byculla East',
		position: new google.maps.LatLng(18.976896, 72.835742),
		type: 'info',
		loc_type: 'Slum',
		hungry: 19
		}, {
		title:'Bhandup East',
		text:'Lol',
		position: new google.maps.LatLng(19.149193, 72.94614),
		type: 'info',
		loc_type: 'Roadside Area Encroachment',
		hungry: 12
		}, {
		title:'Dharavi Village',
		position: new google.maps.LatLng(19.0470003, 72.853),
		type: 'info',
		loc_type: 'Slum',
		hungry: 89
		}, {
		title:'Kumbhar Wada',
		position: new google.maps.LatLng(19.0379, 72.8549),
		type: 'info',
		loc_type: 'Footpath',
		hungry: 28
		}, {
		title:'Deonar Municipal Colony',
		position: new google.maps.LatLng(19.0539, 72.9242),
		type: 'info',
		loc_type: 'Dumping Ground',
		hungry: 45
		}, {
		title:'Phule Nagar, Chembur',
		position: new google.maps.LatLng(19.064933, 72.902926),
		type: 'info',
		loc_type: 'Slum',
		hungry: 37
		}, {
		title:'Mankhurd',
		position: new google.maps.LatLng(19.050598, 72.940580),
		type: 'info',
		loc_type: 'Railway Station',
		hungry: 44
		}
		];
		
		// Create markers.
		features.forEach(function(feature) {
		var marker = new google.maps.Marker({
		title: feature.title,
		position: feature.position,
		icon: icons[feature.type].icon,
		map: map
		});
		var contentString =
		'<p><b>Location: </b>'+feature.title+'</p>'+
		'<p><b>Coordinates: </b>'+feature.position+'</p>'+
		'<p><b>Location Type: </b>'+feature.loc_type+'</p>'+
		'<p><b>Approx. Hungry people: </b>'+feature.hungry+'</p>';
	
		var infowindow = new google.maps.InfoWindow({
		content: contentString
		});
		marker.addListener('click', function() {
		infowindow.open(map, marker);
		});
		});
		
		var legend = document.getElementById('legend');
		for (var key in icons) {
		var type = icons[key];
		var name = type.name;
		var icon = type.icon;
		var div = document.createElement('div');
		div.innerHTML = '<img src="' + icon + '"> ' + name;
		legend.appendChild(div);
		}
		map.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(legend);
		}
		</script>
		<script async defer
		src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAUbRHtu3k_fg3jDGk_qAatE5jA4bC_ndE&callback=initMap">
		</script>
		<h4>Complaint Analysis:</h4>
</div>
<div class="container">
    <div class="row"> 
        <div class="col-sm-3"></div>
        <div class="col-sm-6">
        <canvas id="myChart" width="100" height="100">
            <script>
                $(document).ready(function(){
                var endpoint = '/api/charts/datas'
   
			  $.ajax({
			    method: "GET",
			    url: endpoint,
			    success: function(data){
			      var ctx = document.getElementById("myChart").getContext('2d');
			      var myChart = new Chart(ctx, {
			          type: 'bar',
			          data: {
			              labels: data.labels,
			              datasets: [{
			                  label: 'Number of Complaints',
			                  data: data.data,
			                  backgroundColor: [
			                      'rgba(255, 99, 132, 0.2)',
			                      'rgba(54, 162, 235, 0.2)',
			                      'rgba(255, 206, 86, 0.2)',
			                      'rgba(75, 192, 192, 0.2)',
			                      'rgba(153, 102, 255, 0.2)',
			                      'rgba(255, 159, 64, 0.2)'
			                  ],
			                  borderColor: [
			                      'rgba(255,99,132,1)',
			                      'rgba(54, 162, 235, 1)',
			                      'rgba(255, 206, 86, 1)',
			                      'rgba(75, 192, 192, 1)',
			                      'rgba(153, 102, 255, 1)',
			                      'rgba(255, 159, 64, 1)'
			                  ],
			                  borderWidth: 1
			              }]
			          },
			          options: {
			              reponsive: true,
			              scales: {
			                  yAxes: [{
			                      ticks: {
			                          beginAtZero:true
			                      }
			                  }]
			              }
			          }
			      });
			    },
			    error: function(error_data){
			      console.log(error_data)
			    }
			  })
                })
            </script>
        </canvas>
        </div>
        <div class="col-sm-3"></div>
    </div>
</div>


{% endblock content %}